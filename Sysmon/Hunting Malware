Hunting Malware Overview

Malware has many forms and variations with different end goals. The two types of malware that we will be focusing on are RATs and backdoors.
RATs or Remote Access Trojans are used similar to any other payload to gain remote access to a machine. RATs typically come with other Anti-Virus
and detection evasion techniques that make them different than other payloads like MSFVenom. A RAT typically also uses a Client-Server model and 
comes with an interface for easy user administration. Examples of RATs are Xeexe and Quasar. To help detect and hunt malware we will need to first
identify the malware that we want to hunt or detect and identify ways that we can modify configuration files, this is known as hypothesis-based hunting.
There are of course a plethora of other ways to detect and log malware however we will only be covering the basic way of detecting open back connect ports. 

For more information about this technique and examples of malware check out MITRE ATT&CK Software. 

Hunting Rats and C2 Servers##
The first technique we will use to hunt for malware is a similar process to hunting Metasploit.
We can look through and create a configuration file to hunt and detect suspicious ports open on the endpoint.
By using known suspicious ports to include in our logs we can add to our hunting methodology in which we can
use logs to identify adversaries on our network then use packet captures or other detection strategies to continue the investigation.
The code snippet below is from the Ion-Storm configuration file which will alert when specific ports like 1034 and 1604 as well as exclude 
common network connections like OneDrive, by excluding events we still see everything that we want without missing anything and cutting down on noise. 

Power Shell CMD:Get-WinEvent -Path C:\Users\THM-Analyst\Desktop\Scenarios\Practice\Hunting_Rats.evtx -FilterXPath '*/System/EventID=3 and */EventData/Data[@Name="DestinationPort"] and */EventData/Data=8080'
